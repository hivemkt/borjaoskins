<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rifa de Skins - Borj√£o Skins</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@300;400;600;700&family=Bebas+Neue&display=swap" rel="stylesheet">
    <script src="/.netlify/functions/env"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://sdk.mercadopago.com/js/v2"></script>
    <link rel="stylesheet" href="css/rifas.css">
</head>
<body>
    <div class="bg-animation"></div>
    <div class="container">
        <div class="header">
            <a href="linktree-cs.html" style="display: block; width: fit-content; margin: 0 auto;">
                <div class="logo">
                    <img src="images/logodb.png" alt="Logo Borj√£o Skins">
                </div>
            </a>
            <h1 class="title">üé∞ RIFA DE SKINS</h1>
        </div>
        <div id="loadingMessage" class="loading">Carregando rifa...</div>
        <div id="raffleContent" style="display: none;">
            <div class="raffle-card">
                <div class="raffle-image">
                    <img id="raffleImage" src="" alt="Pr√™mio da Rifa">
                </div>
                <div class="raffle-info">
                    <h2 class="raffle-title" id="raffleTitle">-</h2>
                    <p class="raffle-description" id="raffleDescription">-</p>
                    <div class="raffle-stats">
                        <div class="stat-box">
                            <div class="stat-label">Valor por N√∫mero</div>
                            <div class="stat-value" id="pricePerNumber">R$ 0,00</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">N√∫meros Vendidos</div>
                            <div class="stat-value"><span id="soldCount">0</span>/<span id="totalNumbersDisplay">100</span></div>
                        </div>
                    </div>
                    <div id="promoSection" style="display: none;">
                        <div class="promo-badge">üéâ <span id="promoText"></span></div>
                    </div>
                </div>
                <div class="numbers-section">
                    <h3 class="section-title">Escolha seus n√∫meros da sorte</h3>
                    <div class="numbers-grid" id="numbersGrid"></div>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-box" style="background: rgba(255,255,255,0.05); border-color: rgba(148,49,206,0.3);"></div>
                            <span>Dispon√≠vel</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-box" style="background: linear-gradient(135deg, var(--purple), #6b1fa0); border-color: var(--purple);"></div>
                            <span>Selecionado</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-box" style="background: rgba(255,0,0,0.2); border-color: rgba(255,0,0,0.5);"></div>
                            <span>Vendido</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="checkout-section">
                <div class="checkout-info">
                    <div class="selected-count">N√∫meros selecionados: <strong id="selectedCount">0</strong></div>
                    <div class="total-price" id="totalPrice">R$ 0,00</div>
                </div>
                <button class="checkout-btn" id="checkoutBtn" disabled onclick="initCheckout()">Finalizar Compra via PIX</button>
            </div>
        </div>
    </div>
    <div class="admin-trigger" onclick="openAdminPanel()">‚öôÔ∏è</div>

    <div class="modal" id="confirmationModal" style="display: none;">
        <div class="modal-content" style="max-width: 600px; text-align: center;">
            <button class="modal-close" onclick="closeConfirmationModal()">√ó</button>
            
            <div style="font-size: 80px; margin-bottom: 20px;">üéâ</div>
            
            <h2 style="font-family: 'Bebas Neue', sans-serif; font-size: 48px; color: #00ff88; margin-bottom: 10px; letter-spacing: 2px;">
                VOC√ä EST√Å PARTICIPANDO!
            </h2>
            
            <p style="font-size: 18px; color: rgba(255,255,255,0.8); margin-bottom: 30px;">
                Obrigado por participar! Seu(s) n√∫mero(s):
            </p>
            
            <div id="confirmationNumbers" style="display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; margin-bottom: 40px;">
            </div>
            
            <div style="background: rgba(148, 49, 206, 0.1); border: 2px solid var(--purple); border-radius: 15px; padding: 20px; margin-bottom: 30px;">
                <p style="color: var(--purple); font-weight: 600; margin-bottom: 10px;">
                    üì∏ LEMBRE-SE DE TIRAR UM PRINT DA TELA
                </p>
                <p style="font-size: 14px; color: rgba(255,255,255,0.7);">
                    Caso queira lembrar do seu n√∫mero mais tarde!
                </p>
            </div>
            
            <button onclick="proceedToPayment()" style="width: 100%; background: linear-gradient(135deg, var(--purple), #6b1fa0); border: none; color: white; padding: 18px; border-radius: 12px; cursor: pointer; font-weight: 700; font-size: 18px; margin-bottom: 15px;">
                üí≥ Continuar para Pagamento PIX
            </button>
            
            <button onclick="closeConfirmationModal()" style="width: 100%; background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.3); color: white; padding: 15px; border-radius: 12px; cursor: pointer; font-weight: 600;">
                ‚úï Fechar
            </button>
        </div>
    </div>

    <div class="modal" id="pixModal" style="display: none;">
        <div class="modal-content" style="max-width: 500px; text-align: center;">
            <button class="modal-close" onclick="closePixModal()">√ó</button>
            <h2 class="modal-title">üí≥ Pagamento PIX</h2>
            <div id="pixLoading" style="padding: 40px;">
                <div style="font-size: 48px; margin-bottom: 20px;">‚è≥</div>
                <p>Gerando QR Code PIX...</p>
            </div>
            <div id="pixContent" style="display: none;">
                <div style="background: white; padding: 20px; border-radius: 15px; margin: 20px 0;">
                    <div id="qrCodeContainer"></div>
                </div>
                <div style="background: rgba(148, 49, 206, 0.1); padding: 20px; border-radius: 15px; margin: 20px 0;">
                    <p style="margin-bottom: 10px; font-size: 14px; color: rgba(255,255,255,0.7);">Ou copie o c√≥digo PIX:</p>
                    <div style="background: rgba(0,0,0,0.5); padding: 15px; border-radius: 10px; word-break: break-all; font-size: 12px; margin-bottom: 10px;" id="pixCode"></div>
                    <button onclick="copyPixCode()" style="background: #00ff88; color: black; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 700;">üìã Copiar C√≥digo</button>
                </div>
                <div style="background: rgba(0, 255, 136, 0.1); border: 2px solid #00ff88; border-radius: 15px; padding: 20px; margin-top: 20px;">
                    <p style="color: #00ff88; font-weight: 700; margin-bottom: 10px;">‚è±Ô∏è Aguardando pagamento...</p>
                    <p style="font-size: 14px; color: rgba(255,255,255,0.7); margin-bottom: 15px;">Seus n√∫meros est√£o reservados por 15 minutos.<br>Assim que o pagamento for confirmado, voc√™ receber√° seus n√∫meros!</p>
                    <button onclick="closePixModal(true)" style="width: 100%; background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.3); color: white; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: 600; margin-top: 10px;">‚úï Fechar e Verificar Depois</button>
                </div>
            </div>
            <div id="thankYouMini" style="display: none; text-align: center; padding: 40px;">
                <div style="font-size: 64px; margin-bottom: 20px;">‚úÖ</div>
                <h3 style="color: #00ff88; font-size: 24px; margin-bottom: 10px;">Pagamento Confirmado!</h3>
                <p style="font-size: 16px; color: rgba(255,255,255,0.8);">Seus n√∫meros foram liberados com sucesso!<br>Boa sorte! üçÄ</p>
            </div>
        </div>
    </div>

    <div class="admin-panel" id="adminPanel">
        <div class="admin-container">
            <div class="admin-header">
                <h1 class="admin-title">üéÆ PAINEL ADMINISTRATIVO</h1>
                <button class="admin-close" onclick="closeAdminPanel()">Fechar</button>
            </div>
            <div class="admin-section">
                <h2 class="admin-section-title">‚öôÔ∏è Configurar Rifa</h2>
                <div id="noRaffleWarning" style="display: none; background: rgba(255, 165, 0, 0.1); border: 2px solid #ffa500; border-radius: 10px; padding: 15px; margin-bottom: 20px;">
                    <p style="color: #ffa500; font-weight: 600; margin: 0;">‚ö†Ô∏è Nenhuma rifa ativa encontrada. Preencha os dados abaixo e clique em "Criar Nova Rifa".</p>
                </div>
                <div class="form-group">
                    <label class="form-label">T√≠tulo do Pr√™mio</label>
                    <input type="text" class="form-input" id="adminTitle" placeholder="Ex: AK-47 | Redline">
                </div>
                <div class="form-group">
                    <label class="form-label">Descri√ß√£o</label>
                    <textarea class="form-textarea" id="adminDescription" placeholder="Descreva o pr√™mio..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Imagem do Pr√™mio</label>
                    <input type="file" class="form-input" id="adminImageFile" accept="image/*" onchange="handleImageUpload(event)">
                    <p style="font-size: 12px; color: rgba(255,255,255,0.5); margin-top: 5px;">Ou use uma URL:</p>
                    <input type="url" class="form-input" id="adminImage" placeholder="https://..." style="margin-top: 5px;">
                    <div id="imagePreview" style="margin-top: 10px; max-width: 200px; border-radius: 10px; overflow: hidden; border: 2px solid var(--purple); display: none;">
                        <img id="previewImg" style="width: 100%; height: auto;">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Valor por N√∫mero (R$)</label>
                    <input type="number" class="form-input" id="adminPrice" placeholder="5.00" step="0.01" min="0.01">
                </div>
                <div class="form-group">
                    <label class="form-label">Quantidade de N√∫meros (Cotas)</label>
                    <input type="number" class="form-input" id="adminTotalNumbers" placeholder="100" min="10" max="10000" value="100">
                </div>
                <div class="form-group">
                    <label class="form-label">Limite de Cotas por Pessoa</label>
                    <input type="number" class="form-input" id="adminMaxPerPerson" placeholder="0" min="0" max="100" value="0">
                    <p style="font-size: 12px; color: rgba(255,255,255,0.5); margin-top: 5px;">0 = sem limite</p>
                </div>
                <div class="form-group">
                    <div class="form-checkbox">
                        <input type="checkbox" id="adminPromoEnabled">
                        <label class="form-label" style="margin: 0;">Ativar Promo√ß√£o</label>
                    </div>
                </div>
                <div class="form-group" id="promoFields" style="display: none;">
                    <label class="form-label">Desconto (%)</label>
                    <input type="number" class="form-input" id="adminPromoDiscount" placeholder="10" min="1" max="50">
                    <label class="form-label" style="margin-top: 10px;">M√≠nimo de N√∫meros</label>
                    <input type="number" class="form-input" id="adminPromoMinNumbers" placeholder="10" min="2" max="50">
                </div>
                <button class="btn-primary" onclick="saveRaffleConfig()" id="btnSaveRaffle">üíæ Salvar</button>
                <button class="btn-primary" onclick="createNewRaffle()" id="btnCreateRaffle" style="display: none; background: linear-gradient(135deg, #00ff88, #00dd77); color: black;">‚ú® Criar</button>
                <button class="btn-primary" onclick="finishRaffle()" id="btnFinishRaffle" style="background: linear-gradient(135deg, #ff4444, #cc0000); margin-left: 10px;">üèÅ Finalizar</button>
            </div>
            <div class="admin-section">
                <h2 class="admin-section-title">üìä Estat√≠sticas</h2>
                <button class="btn-primary" onclick="exportSales()" style="margin-bottom: 20px; background: linear-gradient(135deg, #00ff88, #00dd77); color: black;">üì• Exportar</button>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Vendido</div>
                        <div class="stat-value" id="adminTotalSold">R$ 0,00</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">N√∫meros Vendidos</div>
                        <div class="stat-value" id="adminNumbersSold">0/100</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Compradores</div>
                        <div class="stat-value" id="adminBuyersCount">0</div>
                    </div>
                </div>
            </div>
            <div class="admin-section">
                <h2 class="admin-section-title">üõí Vendas</h2>
                <div class="sales-list" id="salesList">
                    <p style="text-align: center; color: rgba(255,255,255,0.4);">Nenhuma venda ainda</p>
                </div>
            </div>
            <div class="admin-section">
                <h2 class="admin-section-title">üé≤ Sorteio</h2>
                <button class="btn-primary" onclick="drawWinner()">üé≤ Sortear</button>
                <div id="winnerResult" style="margin-top: 20px; padding: 20px; background: rgba(0,255,136,0.1); border: 2px solid #00ff88; border-radius: 10px; display: none;">
                    <h3 style="color: #00ff88; margin-bottom: 10px;">üèÜ VENCEDOR!</h3>
                    <p id="winnerText"></p>
                </div>
            </div>
        </div>
    </div>
    <script src="js/rifas.js"></script>
</body>
</html>
